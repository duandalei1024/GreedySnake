# GreedySnake 项目文件结构说明

本文档详细说明了项目中每个文件的作用以及文件之间的依赖关系。

## 📁 文件概览

项目包含以下源文件：

- `main.cpp` - 程序入口
- `controller.h/cpp` - 游戏控制器（核心逻辑）
- `point.h/cpp` - 坐标点类（基础类）
- `tools.h/cpp` - 工具函数库（Windows API 封装）
- `startinterface.h/cpp` - 开始界面动画
- `map.h/cpp` - 地图边界类
- `snake.h/cpp` - 蛇类（游戏主体）
- `food.h/cpp` - 食物类（普通食物和限时食物）

---

## 📄 各文件详细说明

### 1. **main.cpp**

**作用：** 程序入口点，启动游戏

**主要功能：**

- 创建 `Controller` 对象
- 调用 `Controller::Game()` 开始游戏主循环

**代码结构：**

```cpp
int main() {
    Controller c;
    c.Game();  // 整个游戏循环
    return 0;
}
```

---

### 2. **controller.h / controller.cpp**

**作用：** 游戏控制核心，管理整个游戏流程和生命周期

**主要功能：**

- `Start()` - 显示开始界面动画
- `Select()` - 难度选择界面（简单/普通/困难/炼狱）
- `DrawGame()` - 绘制游戏主界面（地图和侧边栏）
- `PlayGame()` - 游戏主循环逻辑
- `Menu()` - 暂停菜单（继续/重新开始/退出）
- `GameOver()` - 游戏结束界面
- `Game()` - 一级游戏循环（整合所有阶段）

**关键成员变量：**

- `speed` - 蛇的移动速度（根据难度设置）
- `key` - 当前选择的难度等级（1-4）
- `score` - 游戏得分

**依赖关系：**

- 依赖：`tools.h`, `startinterface.h`, `map.h`, `snake.h`, `food.h`
- 被依赖：`main.cpp`

---

### 3. **point.h / point.cpp**

**作用：** 坐标点基础类，表示屏幕上的一个位置点

**主要功能：**

- `Point(int x, int y)` - 构造函数，设置坐标
- `Print()` - 在当前位置绘制方块 `■`
- `PrintCircular()` - 在当前位置绘制圆形 `●`（用于蛇身）
- `Clear()` - 清除当前位置的显示
- `ChangePosition(int x, int y)` - 改变坐标
- `GetX() / GetY()` - 获取坐标值
- `operator==` - 坐标相等比较

**依赖关系：**

- 依赖：`tools.h`（用于设置光标位置）
- 被依赖：几乎所有其他类（`startinterface`, `map`, `snake`, `food`）

**使用场景：**

- 蛇的身体由多个 `Point` 组成
- 食物的位置是一个 `Point`
- 地图边界由 `Point` 集合定义
- 开始动画使用 `Point` 表示蛇和文字的位置

---

### 4. **tools.h / tools.cpp**

**作用：** Windows 控制台操作工具函数库，封装了常用的 Windows API

**主要功能：**

- `SetWindowSize(int cols, int lines)` - 设置控制台窗口大小
- `SetCursorPosition(int x, int y)` - 设置光标位置（用于精确定位输出）
- `SetColor(int colorID)` - 设置文本颜色
- `SetBackColor()` - 设置文本背景色（高亮显示）

**依赖关系：**

- 依赖：`<windows.h>`（Windows API）
- 被依赖：几乎所有其他文件（基础工具）

**技术说明：**

- 由于图形字符 `■` 占 2 个字符宽度，所以坐标计算时 `x * 2`
- 使用 Windows Console API 实现精确的字符定位和颜色控制

---

### 5. **startinterface.h / startinterface.cpp**

**作用：** 游戏开始界面，显示蛇形动画和"SNAKE"文字动画

**主要功能：**

- `PrintFirst()` - 蛇从左边出现的动画
- `PrintSecond()` - 蛇从左向右移动的动画
- `PrintThird()` - 蛇消失同时"SNAKE"文字出现的动画
- `PrintText()` - 绘制"SNAKE"文字
- `ClearText()` - 清除文字（用于动画效果）
- `Action()` - 执行完整的开始动画序列

**关键成员变量：**

- `startsnake` - 开始动画中的蛇（`deque<Point>`）
- `textsnake` - 开始动画中的文字（`vector<Point>`）
- `speed` - 动画播放速度

**依赖关系：**

- 依赖：`point.h`
- 被依赖：`controller.cpp`

---

### 6. **map.h / map.cpp**

**作用：** 游戏地图类，定义游戏区域的边界

**主要功能：**

- `Map()` - 构造函数，初始化地图边界点（矩形框）
- `PrintInitmap()` - 绘制初始地图边界

**地图结构：**

- 边界范围：x: 1-30, y: 1-30
- 使用 `vector<Point>` 存储所有边界点

**依赖关系：**

- 依赖：`point.h`
- 被依赖：`controller.cpp`

---

### 7. **snake.h / snake.cpp**

**作用：** 蛇类，游戏的核心对象，控制蛇的移动、增长和碰撞检测

**主要功能：**

- `InitSnake()` - 初始化蛇（在游戏开始时绘制）
- `Move()` - 蛇增长（吃到食物后）
- `NormalMove()` - 蛇正常移动（头增长、尾缩短）
- `OverEdge()` - 检测是否撞墙
- `HitItself()` - 检测是否撞到自己
- `ChangeDirection()` - 处理键盘输入，改变移动方向
- `GetFood()` - 检测是否吃到普通食物
- `GetBigFood()` - 检测是否吃到限时食物

**关键成员变量：**

- `snake` - 蛇的身体（`deque<Point>`，使用双端队列便于头尾操作）
- `direction` - 当前移动方向（UP/DOWN/LEFT/RIGHT）

**输入处理：**

- 方向键（↑↓←→）- 改变移动方向
- ESC 键 - 暂停游戏（返回 false 触发菜单）

**友元关系：**

- `Food` 类是友元类，可以访问 `snake` 的私有成员（用于检查食物是否与蛇身重叠）

**依赖关系：**

- 依赖：`point.h`, `food.h`（前向声明）
- 被依赖：`controller.cpp`, `food.cpp`

---

### 8. **food.h / food.cpp**

**作用：** 食物类，生成和管理普通食物和限时食物

**主要功能：**

- `DrawFood(Snake&)` - 生成并绘制普通食物（★）
- `DrawBigFood(Snake&)` - 生成并绘制限时食物（■）
- `FlashBigFood()` - 闪烁显示限时食物并更新进度条
- `GetCnt()` - 获取食物计数器（每 5 个普通食物出现 1 个限时食物）
- `GetBigFlag()` - 获取限时食物是否存在标记
- `GetProgressBar()` - 获取限时食物进度条值

**关键成员变量：**

- `x, y` - 普通食物的坐标
- `big_x, big_y` - 限时食物的坐标
- `big_flag` - 是否有限时食物的标记
- `flash_flag` - 限时食物闪烁标记
- `progress_bar` - 限时食物进度条（递减，归零后食物消失）
- `cnt` - 食物计数器（每 5 个普通食物出现 1 个限时食物）

**食物机制：**

- 普通食物：随机生成在地图内，不与蛇身重叠
- 限时食物：每吃 5 个普通食物后出现，有进度条倒计时，过期自动消失

**友元关系：**

- `Snake` 类是友元类，可以访问 `Food` 的私有成员（坐标和标记）

**依赖关系：**

- 依赖：`snake.h`（前向声明）, `tools.h`
- 被依赖：`controller.cpp`, `snake.cpp`

---

## 🔗 文件依赖关系图

```
main.cpp
  └── controller.h/cpp
        ├── tools.h/cpp (基础工具)
        ├── startinterface.h/cpp
        │     └── point.h/cpp ──┐
        ├── map.h/cpp           │
        │     └── point.h/cpp ──┤
        ├── snake.h/cpp         │
        │     ├── point.h/cpp ──┼── tools.h/cpp
        │     └── food.h/cpp    │     (相互依赖)
        └── food.h/cpp          │
              └── snake.h/cpp ──┘
```

### 依赖层次说明：

1. **最底层（基础层）：**

   - `tools.h/cpp` - 所有类都依赖的工具函数
   - `point.h/cpp` - 基础坐标类，被多个类使用

2. **中间层（游戏对象层）：**

   - `snake.h/cpp` 和 `food.h/cpp` - 相互依赖（友元关系）
   - `map.h/cpp` - 独立的地图类
   - `startinterface.h/cpp` - 独立的界面动画类

3. **最顶层（控制层）：**
   - `controller.h/cpp` - 整合所有组件，控制游戏流程
   - `main.cpp` - 程序入口

---

## 🎮 游戏流程与文件协作

### 游戏启动流程：

1. **main.cpp** → 创建 `Controller` 对象
2. **controller.cpp** → 调用 `Start()`
   - 使用 **startinterface.cpp** 显示开始动画
3. **controller.cpp** → 调用 `Select()`
   - 用户选择游戏难度（使用 **tools.cpp** 控制输入）
4. **controller.cpp** → 调用 `DrawGame()`
   - 使用 **map.cpp** 绘制地图边界
5. **controller.cpp** → 调用 `PlayGame()`
   - 创建 **snake.cpp** 对象（初始化蛇）
   - 创建 **food.cpp** 对象（生成食物）
   - 进入游戏循环：
     - **snake.cpp** 处理键盘输入和移动
     - **snake.cpp** 检测碰撞（撞墙、撞自己、吃食物）
     - **food.cpp** 管理食物生成和限时食物闪烁
     - **controller.cpp** 更新分数和游戏状态

### 游戏循环中的交互：

```
Controller (主循环)
    ↓
  Snake (移动、输入、碰撞检测)
    ↕ (友元关系，互相访问)
  Food (食物生成、闪烁)
    ↓
  Point (坐标操作)
    ↓
  Tools (窗口、光标、颜色控制)
```

---

## 🔧 关键设计模式

1. **友元类设计：**

   - `Snake` 和 `Food` 互为友元，便于互相访问私有成员，简化碰撞检测逻辑

2. **容器选择：**

   - `Snake::snake` 使用 `deque`（双端队列）- 便于在头尾添加/删除
   - `Map::initmap` 使用 `vector`（向量）- 只需遍历，不需要频繁插入删除

3. **模块化设计：**
   - 每个类职责单一明确
   - 通过控制器类整合各个模块
   - 便于维护和扩展

---

## 📝 扩展建议

如果需要扩展功能，可以参考以下结构：

- **添加新地图：** 在 `map.h` 中添加新的地图容器（如 `map1`, `map2`），并在 `snake.cpp` 中添加相应的边界检测
- **添加新食物类型：** 在 `food.h/cpp` 中添加新的食物成员和生成逻辑
- **修改游戏难度：** 在 `controller.cpp` 的 `Select()` 中调整 `speed` 值

---

## 📚 总结

本项目采用了良好的面向对象设计，各个类的职责清晰：

- **Point** - 基础数据类型
- **Tools** - 系统工具封装
- **Map/Snake/Food** - 游戏对象
- **StartInterface** - UI 界面
- **Controller** - 游戏控制器
- **Main** - 程序入口

文件之间的依赖关系清晰，便于理解和维护代码。
